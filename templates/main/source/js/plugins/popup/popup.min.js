(function(){function b(){this.tags={},this.tags.popup=f('popup',document.body),this.tags.popup__overlay=f('popup__overlay',this.tags.popup),this.tags.popup__table=f('popup__table',this.tags.popup),this.tags.popup__cell=f('popup__cell',this.tags.popup__table),this.tags.popup__block=f('popup__block',this.tags.popup__cell),this.tags.popup__close=f('popup__close',this.tags.popup__block),this.tags.popup__change=f('popup__change',this.tags.popup__block),this.eventsTrigger=d?'touchend':'mouseup',this.events(),this.scrollWidth=this.scrollWidthElement(),this.defaults={clearClose:!0,bodyHidden:!0,addClassNamePopup:'',closeOverlay:!0,closeShow:!0,background:'',closeButtons:'',offsetY:0,offsetX:0,coordElement:''}}var d=/Android|iPhone|iPad|iPod|BlackBerry|WPDesktop|IEMobile|Opera Mini/i.test(navigator.userAgent),f=function(g,h){var k=document.createElement('div');return k.className=g,h&&h.appendChild(k),k};b.prototype={options:function(g){return this.defaults=this.extend({clearClose:!0,bodyHidden:!0,addClassNamePopup:'',closeOverlay:!0,closeShow:!0,background:'',closeButtons:'',offsetY:0,offsetX:0,coordElement:''},g),this.defaults.background&&(this.tags.popup.style.background=this.defaults.background),this},extend:function(g,h){for(var k in h)h.hasOwnProperty(k)&&(g[k]=h[k]);return g},addCloseButtons:function(){var g=this,h=this.defaults.closeButtons.split(',');h.forEach(function(k){var m=document.querySelectorAll(k.replace(/\s+/g,''));Array.prototype.forEach.call(m,function(o){o.addEventListener(g.eventsTrigger,function(q){return q.stopPropagation(),g.close(),!1},!1)})})},coordSet:function(){var g=this,h=document.querySelector(this.defaults.coordElement);return h&&(this.coords=h.getBoundingClientRect(),this.tags.popup__block.style.left=(this.defaults.bodyHidden?0:window.pageXOffset)+this.coords.left+this.defaults.offsetX+'px',this.tags.popup__block.style.top=(this.defaults.bodyHidden?0:window.pageYOffset)+this.coords.top+this.defaults.offsetY+'px',this.tags.popup__block.style.position='absolute'),this},coordReset:function(){var g=this;return this.defaults={clearClose:!0,bodyHidden:!0,addClassNamePopup:'',closeOverlay:!0,closeShow:!0,background:'',closeButtons:'',offsetY:0,offsetX:0,coordElement:''},setTimeout(function(){g.tags.popup.style.background=''},500),this.tags.popup__block.style.left='',this.tags.popup__block.style.top='',this.tags.popup__block.style.position='',this},setBodyStyle:function(){var g=window.innerHeight<document.body.scrollHeight;return this.defaults.bodyHidden&&(document.body.classList.add('popup__body_hidden'),g&&(document.body.style.paddingRight=this.scrollWidth+'px')),this},clearBodyStyle:function(){return document.body.classList.remove('popup__body_hidden'),document.body.style.paddingRight='',this},html:function(g,h){return this.tags.popup__change.innerHTML='',this.setHtml(this.tags.popup__change,g),h&&h.call(this.tags.popup,this.defaults,this.eventsTrigger),this},append:function(g,h){return this.setHtml(this.tags.popup__change,g),h&&h.call(this.tags.popup,this.defaults,this.eventsTrigger),this.defaults.closeButtons&&this.addCloseButtons(),this},clear:function(g){return(this.defaults.clearClose||g)&&(this.tags.popup__change.innerHTML=''),this},show:function(g){return this.tags.popup__close.style.display=this.defaults.closeShow?'':'none',this.setBodyStyle(),this.defaults.coordElement&&this.coordSet(),this.defaults.closeButtons&&this.addCloseButtons(),this.defaults.addClassNamePopup&&this.tags.popup.classList.add(this.defaults.addClassNamePopup),this.tags.popup.classList.add('popup_active'),g&&g.call(this.tags.popup,this.defaults,this.eventsTrigger),this},close:function(g){var h=this;return setTimeout(function(){h.tags.popup.classList.remove('popup_active'),h.defaults.addClassNamePopup&&h.tags.popup.classList.remove(h.defaults.addClassNamePopup),h.clear(),h.coordReset(),g&&g.call(h.tags.popup,h.defaults,h.eventsTrigger),h.clearBodyStyle()},50),this},setHtml:function(g,h){var k=document.createElement('div');k.innerHTML=h;for(var l=0;l<k.children.length;l++){for(var m=k.children[l],o=document.createElement(m.nodeName),p=0;p<m.attributes.length;p++)o.setAttribute(m.attributes[p].nodeName,m.attributes[p].nodeValue);if(0==m.children.length)switch(m.nodeName){case'SCRIPT':m.text&&(o.text=m.text);break;default:m.innerHTML&&(o.innerHTML=m.innerHTML);}else this.setHtml(o,m.innerHTML);g.appendChild(o)}},events:function(){var g=this;this.tags.popup__close.addEventListener(this.eventsTrigger,function(h){return h.stopPropagation(),g.close(),!1},!1),this.tags.popup__overlay.addEventListener(this.eventsTrigger,function(h){return h.stopPropagation(),g.defaults.closeOverlay&&g.close(),!1},!1),document.addEventListener('keydown',function(h){27==h.which&&g.close()},!1)},scrollWidthElement:function(){var g=document.createElement('div');g.style.overflowY='scroll',g.style.width='50px',g.style.height='50px',g.style.visibility='hidden',document.body.appendChild(g);var h=g.offsetWidth-g.clientWidth;return document.body.removeChild(g),h}},window.Popup=b})(window);